---
import Label from "../../components/Label";
import { SITE_TITLE, SITE_DESCRIPTION } from "../../consts";
import { getCollection } from "astro:content";
import FormattedDate from "../../components/FormattedDate.astro";
import BaseLayout from "../../layouts/BaseLayout.astro";

const calculateRemainingDays = (targetDate: Date) => {
	const currentDate = new Date();
	const timeDifference = targetDate.valueOf() - currentDate.valueOf();
	const daysRemaining = Math.ceil(timeDifference / (1000 * 60 * 60 * 24));
	return daysRemaining < 0 ? -1 : daysRemaining;
};

const first_half = (await getCollection("blog")).filter(
	(post) => calculateRemainingDays(post.data.pubDate) > -1,
);
const second_half = (await getCollection("blog")).filter(
	(post) => calculateRemainingDays(post.data.pubDate) < 0,
);

const future_posts = first_half.sort(
	(b, a) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);

const past_posts = second_half.sort(
	(a, b) => a.data.pubDate.valueOf() - b.data.pubDate.valueOf(),
);

second_half.forEach((element) => {
	console.log(element.data.title);
});
console.log("future");
first_half.forEach((element) => {
	console.log(element.data.title);
});

// Funktion zur Berechnung der verbleibenden Tage
---

<style>
	main {
		width: 960px;
	}
	ul {
		display: flex;
		flex-wrap: wrap;
		gap: 2rem;
		list-style-type: none;
		margin: 0;
		padding: 0;
	}
	ul li {
		width: calc(50% - 1rem);
	}
	ul li * {
		text-decoration: none;
		transition: 0.2s ease;
	}
	ul li:first-child {
		width: 100%;
		text-align: center;
	}
	ul li:first-child img {
		width: 100%;
	}
	ul li img {
		border-radius: 12px;
	}
	ul li a {
		display: block;
	}
	.title {
		margin-top: 0.5rem;
		color: rgb(var(--black));
		line-height: 1;
		font-family: "NG", sans-serif;
		font-size: 1.8rem;
		margin-bottom: 1rem;
		cursor: context-menu;
	}
	.date {
		margin: 0;
		color: rgb(var(--gray));
		font-size: 0.8rem;
		font-family: "NG-light", sans-serif;
		cursor: context-menu;
	}

	@media (max-width: 720px) {
		ul {
			gap: 0.5em;
		}
		ul li {
			width: 100%;
			text-align: center;
		}
		.title {
			font-size: 1.4rem;
		}
	}

	@media (max-width: 400px) {
		.title {
			font-size: 1rem;
		}
	}

	.zoom-img {
		width: 100%;
		object-fit: cover;
		transition: all 0.3s ease-in-out;
	}

	.zoom-img:hover {
		transform: scale(102%);
	}
</style>
<BaseLayout title={SITE_TITLE} description={SITE_DESCRIPTION}>
	<main>
		<h1 class="mt-9">Meine Veranstaltungen</h1>
		<p class="mb-8">
			Hier finden Sie bevorstehende und vergangene Veranstaltungen von
			mir. Von privaten Gartenfesten, Mittelalterm√§rkten bis zum
			Altersheim. Schauen Sie sich gerne um und speichern sie einen Termin
			mit einem Klick in ihrem Kalender.
		</p>
		<section>
			<ul>
				{
					future_posts.map((post) => {
						return (
							<li>
								<a href={`/blog/${post.slug}/`}>
									<div class="relative hover:shadow-lg shadow-black zoom-img rounded-md overflow-hidden">
										<img
											width={720}
											height={360}
											src={post.data.heroImage}
											alt=""
										/>

										{post.data.event && (
											<Label post={post} />
										)}
									</div>
								</a>
								<div class="flex justify-between mt-3">
									<h4 class="title">{post.data.title}</h4>
									<p class="date ">
										<FormattedDate
											date={post.data.pubDate}
										/>
									</p>
								</div>
							</li>
						);
					})
				}

				{
					past_posts.map((post) => {
						return (
							<li>
								<a href={`/blog/${post.slug}/`}>
									<div class="relative hover:shadow-lg shadow-black zoom-img rounded-md overflow-hidden">
										<img
											width={720}
											height={360}
											src={post.data.heroImage}
											alt=""
										/>
									</div>
								</a>
								<div class="flex justify-between mt-3">
									<h4 class="title">{post.data.title}</h4>
									<p class="date ">
										<FormattedDate
											date={post.data.pubDate}
										/>
									</p>
								</div>
							</li>
						);
					})
				}
			</ul>
		</section>
	</main>
</BaseLayout>
